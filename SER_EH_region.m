clear;
Mt = 3;
mu = 0.5;
rhot = 0;
rhol = 0;
PGdb = [0 -0.9 -1.7 -2.6 -3.5 -4.3 -5.2 -6.1 -6.9 -7.8 -4.7 -7.3 -9.9 -12.5 -13.7 -18 -22.4 -26.7];
PG   = (1/(40^3))*10.^(PGdb/10);
sum_p = sum(PG);
L=18;
xi = linspace(0,1,21);

pdb = 35;
p = 10.^(pdb/10);
%SIRdb = [14 16];
%SIR = 10.^(SIRdb/10);
%Eav = p*Mt*sum_p./SIR;
%SNRdb = 20;

Me = [1 3];
pEdb = -1;
pE = 1/(4^3)*10^(pEdb/10).*Me;


[ Pisia ] = ISI_Analytical( p, PGdb, Mt, 0, 0,L );
[ Pisi, Psig ] = ISI_Simulation(  p, PGdb, Mt, 0, 0, L );

for k = 1: 2
for i = 1: length(xi)
    EHa(k,i) = mu*(1-xi(i))*(Pisia + p*Mt*sum_p + (2*L-1)*pE(k));
    EH(k,i) = mu*(1-xi(i))*(Pisi + p*Mt*sum_p + (2*L-1)*pE(k));
    [SER1(k,i)] = SEP_TRP2P_analytical (rhot,rhol,PGdb,xi(i), Me(k), pEdb, pdb);
    [SER2(k,i)] = SEP_TRP2P (rhot,rhol,PGdb,xi(i), Me(k), pEdb, pdb);

end
end
figure(3); clf;
semilogy (EHa(1,:),SER1(1,:), '-k', EHa(2,:),SER1(2,:),'-r',            EH(1,:),SER2(1,:), '*k', EH(2,:),SER2(2,:),'*r')
%semilogy (EHa(1,:),SER1(1,:), '-k', EHa(2,:),SER1(2,:),'-r')
xlabel('Harvested Energy (mW)')
ylabel('Average SER')
legend('Analytical - M_ E = 1','Analytical - M_ E = 3','Simulation - M_ E = 1','Simulation - M_ E = 3',1 )



%SER1(1,:) = [0.874912499999970 0.0149279044310064 0.00271656699859783 0.000980001689484791 0.000495350943206537 0.000303642436069405 0.000210061411921748 0.000157574962194448 0.000125119904004912 0.000103558462817351 8.84296787154241e-05];
%SER1(2,:) = [0.874912499999970 0.0102903003874304 0.00112932042560002 0.000262475885565360 9.24454831946326e-05 4.21526187453260e-05 2.28329043142172e-05 1.39569918403262e-05 9.31801302990816e-06 6.64776516588148e-06 4.99193064426892e-06];

%SER2(1,:) = [0.876140000000000 0.0154500000000000 0.00263000000000000 0.000890000000000000 0.000470000000000000 0.000310000000000000 0.000190000000000000 0.000150000000000000 0.000130000000000000 0.000101000000000000 8.90000000000000e-05];
%SER2(2,:) = [0.875390000000000 0.0100400000000000 0.00110000000000000 0.000300000000000000 9.00000000000000e-05 4.00000000000000e-05 2.38329043142172e-05 1.45569918403262e-05 9.51801302990816e-06 6.54776516588148e-06 4.79193064426892e-06];




